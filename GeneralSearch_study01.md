---
# Configurations
# black, white, league, beige, sky, simple, serif, night, moon, solarized
theme: league
# cube, page, concave, zoom, linear, fade, none, default
transition: slide
#  Syntax highlighting style https://highlightjs.org/static/demo/
highlight: solarized-dark
backgroundTransition: zoom
progress: true
controls: true
hideAddressBar: true

# Editor settings
editor:
    fontSize: 14
    theme: solarized_light
    # keybinding: vim
---
# åŸºç›¤æ±ç”¨æ¤œç´¢
## å‹‰å¼·ä¼šï¼‘
### ã€ã‚¯ãƒ¬ã‚«é€£æºæ©Ÿèƒ½æ¦‚è¦ã€‘

2021/06/17

@chuang.li
---
<!-- .slide: data-auto-animate -->
## ç›® æ¬¡

1. æ±ç”¨æ¤œç´¢ã¯ä½•
1. æ±ç”¨æ¤œç´¢ä»•çµ„ã¿
1. ã‚¯ãƒ¬ã‚«é€£æºæ©Ÿèƒ½èª¬æ˜
---
<!-- .slide: data-auto-animate -->
## ç›® æ¬¡

1. <div data-id="box" style="height: 50px; background: grey;">æ±ç”¨æ¤œç´¢ã¯ä½•</div>
1. æ±ç”¨æ¤œç´¢ä»•çµ„ã¿
1. ã‚¯ãƒ¬ã‚«é€£æºæ©Ÿèƒ½èª¬æ˜
---
<!-- .slide: data-auto-animate -->
## æ±ç”¨æ¤œç´¢ã¯ä½•
> âãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ‹…å½“è€…ãƒ»åˆ†æè€…ãŒè‡ªå‹•åŒ–ã—ã¦ã„ãªã„æ–½ç­–ã®ã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°ãƒªã‚¹ãƒˆã‚’ç°¡ä¾¿ã«ä½œæˆã™ã‚‹ãŸã‚ã€ã¾ãŸå¯¾è±¡ã¨ãªã‚‹é¡§å®¢æ•°ã®ç¢ºèªã«ä½¿ç”¨ã™ã‚‹ã€‚â

ãƒ¼ãƒ¼ã€Œæ±ç”¨æ¤œç´¢æ¦‚è¦èª¬æ˜_v1.16ã€

ğŸ¥´ <!-- .element: class="fragment " data-fragment-index="1" -->

Note:
å‚ç…§è³‡æ–™ã®ç´¹ä»‹
---
<!-- .slide: data-auto-animate -->
## æ±ç”¨æ¤œç´¢ã¯ä½•
> âãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ‹…å½“è€…ãƒ»åˆ†æè€…ãŒ**è‡ªå‹•åŒ–ã—ã¦ã„ãªã„æ–½ç­–**ã®ã‚¿ãƒ¼ã‚²ãƒ†ã‚£ãƒ³ã‚°ãƒªã‚¹ãƒˆã‚’ç°¡ä¾¿ã«ä½œæˆã™ã‚‹ãŸã‚ã€ã¾ãŸ**å¯¾è±¡ã¨ãªã‚‹é¡§å®¢æ•°ã®ç¢ºèª**ã«ä½¿ç”¨ã™ã‚‹ã€‚â

ãƒ¼ãƒ¼ã€Œæ±ç”¨æ¤œç´¢æ¦‚è¦èª¬æ˜_v1.16ã€

ğŸ¤”

Note:
å‚ç…§è³‡æ–™ã®ç´¹ä»‹
---
<!-- .slide: data-auto-animate -->

### æ–½ç­–ã®å±æ€§
<div class="r-hstack justify-center">
<div data-id="box1" style="background: #999; width: 250px; height: 50px; margin: 10px; border-radius: 5px;" data-auto-animate-target="">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼</div>
<div data-id="box2" style="background: #999; width: 250px; height: 50px; margin: 10px; border-radius: 5px;" data-auto-animate-target="">éãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼</div>
</div>

Note:
å®šæœŸã€é•·æœŸçš„ãªæ–½ç­–
è¦ä»¶ãŒæ˜ç¢ºãªæ–½ç­–

çªç™ºçš„ãªæ–½ç­–
çŸ­æœŸçš„ãªæ–½ç­–
PoCå®Ÿé¨“çš„ãªæ–½ç­–
---
<!-- .slide: data-auto-animate -->
### ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®å±æ€§
<div class="r-hstack justify-center">
<div data-id="box1" data-auto-animate-delay="0" style="background: orange; width: 150px; height: 150px; border-radius: 150px;" data-auto-animate-target="51">å®šæœŸ<br>å®šé‡<br>å®šå¸¸</div>
<div data-id="box2" data-auto-animate-delay="0.1" style="background: red; width: 150px; height: 150px; border-radius: 150px;" data-auto-animate-target="52">éæ˜ç¢º<br>è‡ªç”±</div>
</div>

Note:
æ±ºã¾ã£ã¦ã‚‹æ–½ç­–ã‚’æ±ºã¾ã£ã¦ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’åˆ†æã—ã€æ±ºã¾ã£ã¦ã‚‹ãƒ«ãƒ¼ãƒˆã§æ±ºã¾ã£ã¦ã‚‹å¯¾è±¡è€…ã«é…ä¿¡ã™ã‚‹ã€‚ï¼ˆæ–°è¦ãƒ¦ãƒ¼ã‚¶welcomeï¼‰
æ–½ç­–è‡ªç”±ã€ãƒ‡ãƒ¼ã‚¿ãƒãƒ¼ãƒˆä¸Šã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã€SMCä»¥å¤–ä»–ã‚·ã‚¹ãƒ†ãƒ ã€ç”¨é€”ãŒåºƒã„ã€‚
---
<!-- .slide: data-auto-animate -->
### å¯¾è±¡è€…ãƒªã‚¹ãƒˆã®é€£æºæ–¹å¼
<div class="r-stack">
<div data-id="box1" style="background: green; width: 300px; height: 300px; border-radius: 200px; font-size:30px;" data-auto-animate-target="55"><h5><br>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ</h5></div>
<div data-id="box2" style="background: red; width: 150px; height: 150px; border-radius: 150px; position: absolute; top: 40%; left: 50%; font-size:30px;" data-auto-animate-target="56"><br>æ±ç”¨æ¤œç´¢<br>æ‰‹å‹•</div>
<div data-id="box3" style="background: orange; width: 150px; height: 150px; border-radius: 150px; position: absolute; top: 40%; right: 50%; font-size:30px;" data-auto-animate-target="57"><br>SMC/BP<br>è‡ªå‹•</div>
</div>

ğŸ˜€ <!-- .element: class="fragment " data-fragment-index="1" -->
---
<!-- .slide: data-auto-animate -->
## ç›® æ¬¡

1. æ±ç”¨æ¤œç´¢ã¯ä½•
1. <div data-id="box" style="height: 50px; background: grey;">æ±ç”¨æ¤œç´¢ä»•çµ„ã¿</div>
1. ã‚¯ãƒ¬ã‚«é€£æºæ©Ÿèƒ½èª¬æ˜
---
<!-- .slide: data-auto-animate -->
## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

![snip_20210617_025828.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/89709/6f2441ec-3d49-dde1-3557-210190425343.png)

---
<!-- .slide: data-auto-animate -->
## ã‚¢ãƒ—ãƒªé…ç½®æ¦‚è¦

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/89709/ab260e15-979f-f255-b74e-da874cb74775.png" width="60%">

---
<!-- .slide: data-auto-animate -->
## ã‚¢ãƒ—ãƒªé…ç½®æ¦‚è¦

<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/89709/6834bfbe-8a81-02fa-d558-5213a1ea3000.png" width="60%">

---
<!-- .slide: data-auto-animate -->
## ã‚¢ãƒ—ãƒªé…ç½®æ¦‚è¦
#### ã‚¢ãƒ—ãƒªé¸æŠç”»é¢
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/89709/b1d10b92-357a-89ae-0e3b-be75c57592cd.png)
---
<!-- .slide: data-auto-animate -->
### é€£æºãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

|  | å…¨é …ç›®/ID | SEJ/IY/FS |
| ------ |:------:| :-----:|
| æ‹¡å¼µå­ | TXT | CSV |
| åœ§ã€€ç¸® | ZIP | ZIP |
| æ”¹ã€€è¡Œ | LF | LF |
| åŒºåˆ‡ã‚Š | ãªã— | ãªã— |
| æ–‡ã€€å­— | UTF-8 | UTF-8 |

 (7CEã‚’é™¤ã)
---
<style>
.smalltable > table, .smalltable > th, .smalltable > td {
    font-size: 75%;
}
</style>
<!-- .slide: data-auto-animate -->
### é€£æºãƒ•ã‚¡ã‚¤ãƒ«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

<div class="smalltable">

| &nbsp; &nbsp;&nbsp; &nbsp;| å…¨é …ç›®/ID | SEJ/IY/FS |
| ----- |:------:| :-----:|
| ãƒ˜ãƒƒãƒ€ãƒ¼&nbsp;&nbsp;&nbsp;| ãªã— | ãªã—|
| æš—å·åŒ– | ãªã— | ãªã— |
| ã‚«ãƒ©ãƒ æ•° | 1 | 1 |
| ãƒ•ã‚¡ã‚¤ãƒ«å&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| IFID-datetime.zip | IFID_ä¼šç¤¾ã‚³ãƒ¼ãƒ‰_ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç¨®åˆ¥_æ–½ç­–ID_ãƒãƒ¼ã‚¸ãƒ§ãƒ³.zip |

</div>

Note:
7CEã¡ã‚‡ã£ã¨ç‰¹æ®Šãªã®ã§ã€æ¬¡å›ã§ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚
---
## ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ Tips

- Redshift SQL Script
  å¤§é‡ãƒ‡ãƒ¼ã‚¿ä½œæˆæ–¹æ³•.txt
- CSVãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
  testdata2csv.py
```py
# 200M Size
$ python testdata2csv.py 815000
write 815000 test items done!
  ```
---
<!-- .slide: data-transition="zoom-in zoom-out" -->
## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

> upload + copy time â‰ˆ insert time

| records | Insert | S3 Copy  |
| -------- |:------:| -----:|
| 1k | 0.3s | 0.65s |
| 10k | 1.90s |  1.99s |
| 100k | 9.10s | 9.20s |

*å‚ç…§ï¼š[stackoverflow](https://stackoverflow.com/questions/25454477/amazon-redshift-bulk-insert-vs-copying-from-s3?rq=1)
---
## ãƒ‡ãƒãƒƒã‚° Tips

- ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèªã™ã‚‹
- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚ªãƒ³
```py
# main/settings.py
DEBUG = True
```
- ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹
- ã‚¢ãƒ—ãƒªèµ·å‹•ã‚³ãƒãƒ³ãƒ‰
```sh
$ python manage.py runserver 0:8080
```

Note:
 0ã¯0.0.0.0 ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã§ã™ã€‚
 8080ã¯ãƒãƒ¼ãƒˆãƒŠãƒ³ãƒãƒ¼
 Pythonã‚³ãƒ¼ãƒ‰å¤‰æ›´ã—ã¦ã‚‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•çš„ã«ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
---
### ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```sh
$ sudo vim /etc/secret/general_search.yml
```
```yml
mysql:
    host: sevenandi-stgdb02.cvhb3esx6t5b.ap-northeast-1.rds.amazonaws.com
    user: general_search
    password: P@ssw0rd
    database: general_search
    port: 3306

log:
    log_path: \7iGeneralSearch\log\django.log

passwordreset:
    file_path: C:\Users\Public\Documents\pwdreset

redshift:
    host: redshift-stg01.cpmundnkeusy.ap-northeast-1.redshift.amazonaws.com
    port: 5439
    db_name: prd_database
    user: screenuser
    password: Redsh1ft_screenuser
    devgroup:
        user: screenuser
        password: Redsh1ft_screenuser
    anlgroup:
        user: screenuser
        password: Redsh1ft_screenuser
    sejgroup:
        user: screensej
        password: Redsh1ft_screesej
    iygroup:
        user: screeniy
        password: Redsh1ft_screeniy
    seven_fsgroup:
        user: screenseven_fs
        password: Redsh1ft_screenseven_fs
    seven_cegroup:
        user: screenseven_ce
        password: Redsh1ft_screenseven_ce

sej_redshift:
    host: redshift-stg02.cpmundnkeusy.ap-northeast-1.redshift.amazonaws.com
    port: 5439
    db_name: prd_database
    user: screenuser
    password: Redsh1ft_screenuser
    devgroup:
        user: screendev
        password: Redsh1ft_screendev
    anlgroup:
        user: screenanl
        password: Redsh1ft_screenanl
    sejgroup:
        user: screensej
        password: Redsh1ft_screensej
    iygroup:
        user: screeniy
        password: Redsh1ft_screeniy
    seven_fsgroup:
        user: screenseven_fs
        password: Redsh1ft_screenseven_fs

aws:
    key: AKIAIZBOLZXFWQXZXVEA
    secret: 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
    kms: cd6e10e5-d353-4db5-b78c-0eff1e1ea087
    bucket: analytics-7andi-common-dev-test
    iy_bucket: analytics-7andi-common-dev-test
    sej_bucket: analytics-7andi-common-dev-test
    aws_account_id: 898505340510
    role_name: role-analytics-dev-redshift-all

```
---
# End
### 2021/06/17
##### @chuang.li
